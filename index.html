<!DOCTYPE html>
<html>
<head>
    <title>Uhh Yeah Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.75, maximum-scale=1">
    <style>
            h1 {text-align: center;}
      input {display: block; margin:auto;}
* {
  box-sizing: border-box;
}

/* Create two unequal columns that floats next to each other */
.column {
  float: left;
  padding: 10px;
}

.itemborder {
  border-style: solid;
}

.left {
  width: 8%;
}

.center {
  width: 12%;
}

.right {
  width: 80%;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* Solid border */
hr.solid {
  border-top: 3px solid rgb(9, 8, 8);
}

mark { 
  background-color:thistle;
}

@media screen and (max-width: 600px) {
  .column {
    width: 100%;
  }
}
</style>
</head>
<body style="background-color:mintcream">

<h1><a href="/" style='color:slateblue; text-decoration-color:slateblue;'>Uhh Yeah Notes</a></h1>
<br><br>
<input autocomplete="off" 
        type="search" id="search" 
        placeholder="search title or notes"
        style="font-size: 22px; background-color:mintcream; color:slateblue"/>
<br><br>
<a href="javascript:void(0)" id="search_order" style="margin: 10px; color:black;" onclick="changeorder()">Latest</a>
<br><br>
<div id="table" style="font-size: 18px"></div>

<script>
// get data
var rawFile = new XMLHttpRequest();
rawFile.open("GET", "data.json", false);
rawFile.send(null);

var allText = rawFile.responseText;
var parsed = JSON.parse(allText);
parsed.sort(function(a, b) {return b.Episode - a.Episode});

// set up table html
var tableHeader = "<table border=1 frame=void rules=rows><tr><th>Episode</th><th>Date</th><th>Title/Note</th></tr>";
var tableContent = "";
var tableFooter = "</table>";

var secondheader = "<div class='row'>";
var closer = "</div>";

// check for url
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const url_search = urlParams.get('q')

// search
const search = document.getElementById("search");
let search_term = "";

if (url_search != null)
{
  search_term = url_search;
  search.value = search_term;
}


const showList = () => {
  document.innerHTML = "";
  tableContent = "";
  re = new RegExp(search_term, 'g');
  if (search_term != "" && search_term.length > 2)
  {
    parsed
      .filter((item) => {
        return (
          item.Title.toLowerCase().includes(search_term) ||
          item.Note.toLowerCase().includes(search_term)
        );
      })
      .forEach((e) => {
        var link = "<a target='_blank' style='color:black' href='https://uhhyeahdude.com/index.php/show_notes/episode_" + e.Episode + "''>";
          // Loop through the JSON and output each row in to a string.
          tableContent = tableContent + "<hr class='solid'><div class='column left'>" + link + e.Episode + "</a></div>"
                                      + "<div class='column center'>" + e.Date + "</div>"
                                      + "<div class='column right' style='background-color:bisque'><b>" + highlight(e.Title, search_term) 
                                      + "</b><br><br>" + highlight(e.Note, search_term) + "<br><br></div></hr>"
      });
  }
  else 
  {
    parsed
      .forEach((e) => {
        var link = "<a target='_blank' style='color:black' href='https://uhhyeahdude.com/index.php/show_notes/episode_" + e.Episode + "''>";
          // Loop through the JSON and output each row in to a string.
          tableContent = tableContent + "<hr class='solid'><div class='column left'>" + link + e.Episode + "</a></div>"
                                      + "<div class='column center'>" + e.Date + "</div>"
                                      + "<div class='column right' style='background-color:bisque'><b>" + e.Title 
                                      + "</b><br><br>" + e.Note + "<br><br></div></hr>"
    });
  }
    document.getElementById("table").innerHTML = secondheader + tableContent + closer;
};

showList();

search.addEventListener("input", (event) => {
  search_term = event.target.value.toLowerCase();
  urlParams.set('q', search_term);
  history.replaceState({}, "Uhh Yeah Notes Search", "?"+urlParams.toString());
  if (search_term == null || search_term == "")
  {
    history.replaceState({}, "Uhh Yeah Notes Search", "/");
  }
  showList();
});

function highlight(str, find) {
  var reg = new RegExp(find, 'gi');
  return str.replace(reg, '<mark>$&</mark>');
}

function changeorder() {
  var current = document.getElementById("search_order").innerHTML;
  if (current == "Latest")
  {
    parsed.sort(function(a, b) {return a.Episode - b.Episode});
    document.getElementById("search_order").innerHTML = "Earliest";
  }
  else
  {
    parsed.sort(function(a, b) {return b.Episode - a.Episode});
    document.getElementById("search_order").innerHTML = "Latest";
  }

  showList();
}

</script>
</body>

</html>

